<!-- generated by deep-review -->
# deep-review Plugin

## Purpose
Main plugin directory containing all agent definitions, commands, and skills for the deep-review Claude Code plugin. Implements an orchestrator-worker pattern for autonomous code review and architecture assessment, producing REVIEW_REPORT.md and ARCHITECTURE_REPORT.md.

## Key Files
| File | Purpose | Key Exports |
|------|---------|-------------|
| `.claude-plugin/plugin.json` | Plugin manifest | Declares 10 agents, 2 commands, 1 skill |
| `README.md` | User-facing documentation | Installation, usage, architecture |
| `agents/discovery.md` | Phase 1 agent | Maps repo, creates AGENTS.md files, produces batch plan |
| `agents/architect.md` | Phase 2A agent | ATAM-inspired architecture analysis |
| `agents/researcher.md` | Phase 2A agent | Technology best-practices research via web search |
| `agents/synthesizer.md` | Phase 3 agent | Deduplicates findings, writes REVIEW_REPORT.md |
| `agents/architecture-synthesizer.md` | Phase 3 agent | Cross-references architecture inputs, writes ARCHITECTURE_REPORT.md |
| `commands/full-review.md` | Main orchestrator | Coordinates discovery, review+architecture, and synthesis phases |
| `commands/maintain-docs.md` | Incremental doc updater | Updates AGENTS.md after code changes |

## Data Flow
User invokes `/deep-review:full-review` → orchestrator creates `.deep-review/` → launches discovery agent → reads batch plan → launches 5 review agents + architect + researcher (7 parallel for first batch) → verifies outputs → launches both synthesizers in parallel (code review + architecture) → verifies REVIEW_REPORT.md + ARCHITECTURE_REPORT.md → prints summary

## Dependencies
- Internal: None (self-contained plugin)
- External: Claude Code runtime (v0.9+), built-in tools (Bash, Read, Write, Glob, Grep, Task)

## Patterns & Conventions
- File-based IPC: All agents write to `.deep-review/`, orchestrator reads from disk
- All agents run foreground (blocking): Discovery runs sequentially, 5 review agents + 2 architecture agents run as parallel foreground Task calls (7 for first batch), both synthesizers run in parallel
- Dual state tracking: `state.json` (machine-readable), `progress.md` (human-readable)
- Self-review steps: Every agent verifies output completeness before finishing
- Few-shot examples: 2-3 concrete findings per review agent definition

## Configuration
No environment variables. Plugin reads repo metadata (package.json, pyproject.toml, etc.) during discovery phase. Working directory `.deep-review/` is created on-demand and should be gitignored.

## Gotchas
- TaskOutput returns full JSONL transcripts (bloats context) — use file polling instead
- Background task notifications may not fire reliably — explicitly poll for output files
- MCP tools NOT available in background sub-agents — agents use only built-in tools
- Auto-compaction can happen any time — write state before every batch
- Review agents cannot spawn sub-agents — orchestrator must chain everything

## Testing
- Tests: Manual testing via `claude --plugin-dir ./deep-review`
- Run: Load plugin, invoke `/deep-review:full-review` on a test repo
- Gaps: No automated unit tests (plugin system doesn't support test frameworks)

## Boundaries
- **Always:** Validate plugin.json after changes
- **Always:** Keep agent prompts complete and self-contained
- **Ask first:** Changing finding output format (affects 5 agents + synthesizer)
- **Never:** Rely on TaskOutput for agent coordination
- **Never:** Launch agents from within agents

<!-- generated by deep-review -->
# Repo-Reviewer (deep-review Plugin)

## Overview
A Claude Code plugin for autonomous, multi-agent code review. Orchestrates 7 specialized agents through 3 phases (Discovery, Review, Synthesis) to find bugs, security issues, performance problems, and error handling gaps, then generates living AGENTS.md documentation throughout codebases.

## Architecture
```
User: /deep-review:full-review
         │
    Orchestrator (commands/full-review.md)
         │
    ┌────┴─────┬─────────┬────────┐
    │          │         │        │
Phase 1    Phase 2   Phase 3  Docs Maint
Discovery  Review    Synthesis  (maintain-docs)
    │          │         │
    │     5 parallel    │
    │     agents/batch  │
    │                   │
    └──────────┬────────┘
               │
       .deep-review/ (disk-based coordination)
```

## Tech Stack
- Language: Markdown (plugin definition files), JSON (manifest, state)
- Framework: Claude Code plugin system
- Architecture: Orchestrator-Worker with file-based IPC
- No external dependencies

## Directory Map
| Directory | Purpose |
|-----------|---------|
| `deep-review/` | Main plugin root (agents, commands, skills, manifest) |
| `conductor/` | Project management (tracks, workflow, product specs) |
| `architect/` | Architecture design docs (ADRs, interfaces, patterns) |
| `.deep-review/` | Working directory created during review runs (gitignored) |

## Key Commands
```bash
# Install plugin locally for development
claude --plugin-dir ./deep-review

# Run full review (within Claude Code session)
/deep-review:full-review

# Maintain documentation after code changes
/deep-review:maintain-docs

# Verify plugin structure
find deep-review/ -type f | sort

# Validate manifest
python3 -c "import json; json.load(open('deep-review/.claude-plugin/plugin.json'))"
```

## Conventions
- All plugin files are Markdown with YAML frontmatter (agents, commands, skills)
- Agent definitions include explicit checklists, few-shot examples, self-review steps
- File-based coordination via `.deep-review/` directory (not TaskOutput)
- AGENTS.md as primary docs, CLAUDE.md as companion with `@AGENTS.md` reference
- State tracking in dual format: `state.json` (machine), `progress.md` (human)
- Compaction-safe design: write critical state to disk before every batch

## Known Issues
**Critical (6):** Missing commands array in plugin.json (breaks all slash commands), discovery/synthesizer failure with no error recovery, command injection in discovery/orchestrator via unvalidated shell inputs

**High (17):** Systemic missing error handling across orchestrator/agents/maintain-docs, path traversal in AGENTS.md generation, race condition in agent polling (no timeout loop), incomplete Task tool API documentation

**Medium (18):** Batch plan validation gaps, inconsistent constraint enforcement (AND vs OR for batch sizing), unbounded file reading in discovery, passive skill false-positive detection on stale state.json

See `REVIEW_REPORT.md` for full details and fixes.

## Technical Debt
**Architecture:**
- Tight coupling between synthesizer and review agent finding format (no schema validation)
- Implicit contracts between orchestrator and agents (batch plan structure, file naming)
- Mixed error handling patterns (some explicit checks, some `2>/dev/null` suppression)

**Testing:**
- Zero automated tests for any component
- No regression testing for bug fixes
- Critical paths untested: compaction recovery, batch failure thresholds, deduplication logic
- No performance benchmarking for large repositories

**Configuration:**
- Hardcoded batch sizing (50 files, 5000 LOC) with no user override
- Undefined timeouts ("reasonable timeout" without explicit values)
- No way to customize which review agents run (always all 5)

**Portability:**
- Discovery agent assumes Unix environment (wc, sed, uniq, xargs)
- No fallback for Windows without WSL
- Hardcoded file extension list misses newer languages and config-as-code formats

## Boundaries
- **Always:** Test plugin loading with `claude --plugin-dir` before committing
- **Always:** Keep agent definitions under 400 lines, subdirectory AGENTS.md under 60 lines
- **Always:** Write state to disk before launching background agents
- **Ask first:** Changing interface contracts (affects multiple tracks)
- **Ask first:** Adding new agents or commands (impacts orchestration logic)
- **Never:** Use TaskOutput for agent results (context bloat issue #16789)
- **Never:** Modify cross-cutting.md versions (append-only)

---
name: codebase-documentation
description: >
  Maintains living documentation in AGENTS.md files throughout the codebase.
  Auto-triggers when Claude is working on code, modifying files, or exploring
  the codebase. Ensures Claude reads local AGENTS.md before making changes
  and updates them after significant modifications. Does NOT trigger during
  autopsy operations.
---

# Codebase Documentation Skill

This skill helps maintain living AGENTS.md documentation during everyday development. It activates passively when you work on code — not during `/autopsy:full-review` operations.

---

## When to Activate

**DO activate** when:
- Modifying existing code files
- Creating new files or directories
- Changing function signatures, adding dependencies, or altering data flow
- Exploring unfamiliar parts of the codebase

**DO NOT activate** when:
- A `.autopsy/` directory exists and autopsy agents are running
- The current task is explicitly about reviewing or auditing code
- The user is running `/autopsy:full-review` or `/autopsy:maintain-docs`

To detect: Check if `.autopsy/state.json` exists. If it does, read the `"phase"` field:
- If phase is "discovery", "review", or "synthesis" — autopsy is active, do NOT activate
- If phase is "complete" — previous review finished, activate normally
- If state.json does not exist — no review in progress, activate normally
- If state.json exists but was last modified more than 6 hours ago and phase is not "complete" — review was likely abandoned, activate normally

---

## Instructions

### Before Modifying Any File

1. Check if the directory has an `AGENTS.md` file
2. If it does, **read it first** to understand:
   - Module purpose and boundaries
   - Key files and their roles
   - Patterns and conventions to follow
   - Gotchas to be aware of
   - What's always/ask-first/never done in this module

This context prevents you from violating module conventions or introducing inconsistent patterns.

### After Making Significant Changes

"Significant" means: adding files, changing function signatures, adding or removing dependencies, modifying data flow, adding configuration, or discovering non-obvious behavior.

If significant changes were made:

1. Read the directory's AGENTS.md
2. Update the relevant sections:
   - **Key Files:** Add new files, update changed descriptions
   - **Data Flow:** Update if processing pipeline changed
   - **Dependencies:** Add/remove as appropriate
   - **Gotchas:** Add any new non-obvious behavior you discovered
3. Add a dated entry to **Recent Changes:**
   ```markdown
   - {YYYY-MM-DD}: {one-line description of change}
   ```
4. If you modified or created a companion `CLAUDE.md`, ensure it contains `@AGENTS.md`

### Creating New Directories

If you create a new directory that will have 3+ code files:

1. Create an `AGENTS.md` using the standard template with `<!-- generated by autopsy -->` marker
2. Create a companion `CLAUDE.md` containing only `@AGENTS.md`
3. Fill in what you know; use "TODO: investigate" for unknowns

### Fixing Outdated Documentation

If you notice an AGENTS.md that is outdated or inaccurate:

1. Fix the specific inaccuracies
2. **Never delete information** unless it's provably wrong
3. Add "TODO: verify" for things you're uncertain about
4. Add a Recent Changes entry noting the fix

---

## Quality Reminders

- AGENTS.md must be **specific** to the actual code — no generic boilerplate
- Subdirectory AGENTS.md: under 60 lines
- Root AGENTS.md: under 80 lines
- No file trees (they go stale immediately)
- Every statement should reference actual code, files, or behavior
- "TODO: investigate" is better than a guess

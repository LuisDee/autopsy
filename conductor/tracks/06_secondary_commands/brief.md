<!-- ARCHITECT CONTEXT | Track: 06_secondary_commands | Wave: 4 | CC: v1 -->

## Cross-Cutting Constraints
- Dual Documentation Output: AGENTS.md primary + CLAUDE.md companion
- AGENTS.md Quality Bar: specific, under 80/60 lines, no file trees, three-tier boundaries
- Thoroughness Rules: only update what actually changed, be specific, don't remove unless provably wrong

## Interfaces

### Owns
- `commands/maintain-docs.md` (documentation maintenance command)
- `skills/codebase-documentation/SKILL.md` (passive documentation skill)

### Consumes
- `{dir}/AGENTS.md` files (reads existing docs to update them)
- Git history (via `git diff`, `git log` for change detection)

## Dependencies
- Track 01_plugin_scaffold: directory structure must exist
- Track 02_discovery_agent: AGENTS.md template and generation approach should be consistent

<!-- END ARCHITECT CONTEXT -->

# Track 06: Secondary Commands

## What This Track Delivers

Two supporting components: the `/deep-review:maintain-docs` command that keeps AGENTS.md files current after code changes, and the `codebase-documentation` passive skill that auto-triggers during normal development to remind Claude to read/update AGENTS.md files. Together they ensure the documentation generated by the full review stays accurate over time.

## Scope

### IN
- `commands/maintain-docs.md`: detect git changes (last 10 commits or 7 days), identify affected directories, update existing AGENTS.md files (add dated "Recent Changes" entries, update Key Files/Data Flow/Dependencies/Gotchas), create AGENTS.md for new directories with 3+ code files, update root AGENTS.md (directory map, tech stack, conventions), run validation (find directories missing AGENTS.md), print summary
- `skills/codebase-documentation/SKILL.md`: YAML frontmatter (name, description, passive trigger conditions), instructions for reading AGENTS.md before modifying files, updating AGENTS.md after significant changes, creating AGENTS.md for new directories, fixing outdated docs
- Passive skill must NOT trigger during deep-review operations

### OUT
- Nothing — these are leaf components with no downstream consumers

## Key Design Decisions

These should be resolved with the developer during spec generation:

1. **Change detection scope for maintain-docs:** Last 10 commits vs last 7 days vs user-configurable?
   Trade-off: Fixed scope is simpler; configurable adds flexibility but complexity
2. **Passive skill trigger sensitivity:** Trigger on any file modification vs only on "significant" changes (new files, changed signatures, new dependencies)?
   Trade-off: Any modification catches everything; significant-only reduces noise but may miss updates
3. **Passive skill invocation model:** `user-invocable: true` (user can also run it manually) vs `user-invocable: false` (only auto-triggers)?
   Trade-off: Manual invocation is useful for explicit doc updates; auto-only keeps the `/` menu clean
4. **Deep-review detection:** Check for `.deep-review/` directory existence vs check for a specific lock file?
   Trade-off: Directory check is simple; lock file is more precise but adds another file to manage
5. **Maintain-docs as command vs skill:** Keep as `commands/maintain-docs.md` vs move to `skills/maintain-docs/SKILL.md`?
   Trade-off: Commands and skills are now merged; skills is the recommended new approach, but the build plan specifies `commands/`

## Architectural Notes

- The passive skill's `description` field is what determines when Claude auto-invokes it — it must clearly describe the trigger conditions
- Setting `context: fork` on the passive skill would run it in an isolated sub-agent — consider whether this is desirable (protects main context but adds overhead)
- The maintain-docs command uses git commands for change detection — it must handle repos with no commits gracefully
- The validation step (finding directories missing AGENTS.md) should use the same 3+ code files threshold as the discovery agent
- Both components must generate companion CLAUDE.md files alongside AGENTS.md files

## Complexity: M
## Estimated Phases: ~3

# Plan: Discovery Agent (Track 02)

## Phase 1: Agent Definition

### Tasks

- [x] **1.1** Write `deep-review/agents/discovery.md` with YAML frontmatter (name, description, tools) replacing the placeholder
- [x] **1.2** Write Step 1 (Repo Mapping): complete bash commands for file inventory, extension distribution, LOC counting, project metadata detection
- [x] **1.3** Write Step 2 (Module Understanding): instructions for reading files per directory (<10 files: read all, 10+: sample 3-5), with the 9-point analysis checklist (purpose, key files, dependencies, data flow, patterns, config, gotchas, testing)
- [x] **1.4** Write Step 3 (AGENTS.md Generation): trigger rules (3+ code files), subdirectory template (under 60 lines), root template (under 80 lines), companion CLAUDE.md creation, idempotency logic with `<!-- generated by deep-review -->` marker
- [x] **1.5** Write Step 4 (Discovery Profile): `.deep-review/discovery.md` template with repo stats, architecture diagram, module summary table, risk areas
- [x] **1.6** Write Step 5 (Batch Plan Generation): `.deep-review/batch-plan.md` template matching interface contract, directory-based grouping rules, batch sizing constraints (≤50 files / ≤5000 LOC), pattern-based risk scoring (auth, SQL, crypto, payments, user input)
- [x] **1.7** Write Self-Review Checklist: 13-point verification the agent must run before completing

## Phase 2: Validation

### Tasks

- [x] **2.1** Validate YAML frontmatter has name, description, and tools fields
- [x] **2.2** Verify all 5 steps are present with complete instructions
- [x] **2.3** Verify batch plan format matches interface contract in `architect/interfaces.md`
- [x] **2.4** Verify AGENTS.md templates comply with product guidelines (line limits, no file trees, three-tier boundaries)
- [x] **2.5** Verify idempotency marker strategy is documented in the agent definition
